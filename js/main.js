// Translation Data
const translations = {
    vi: {
        nav_home: "Trang Chủ",
        nav_about: "Về Chúng Tôi",
        nav_services: "Dòng Xe",
        nav_explore: "Khám Phá",
        nav_contact: "Liên Hệ",
        nav_language: "Ngôn Ngữ",
        hero_subtitle: "Chào mừng đến với <br class='mobile-break'> Phan Thiết - Mũi Né",
        hero_title: "Hành Trình Tự Do Cùng <br> <span class='text-gold'>Xe Máy Ngọc Mười</span>",
        hero_desc: "Dịch vụ cho thuê xe tay ga cao cấp, uy tín. Khám phá cung đường biển đẹp nhất Việt Nam theo cách riêng của bạn.",
        hero_btn_call: "<i class='fas fa-phone-alt'></i> Gọi Ngay",
        hero_btn_view: "Xem Xe",
        about_title: "Tại Sao Chọn Chúng Tôi?",
        about_desc: "Xe Máy Ngọc Mười tự hào là đơn vị cung cấp dịch vụ thuê xe máy hàng đầu tại Phan Thiết - Mũi Né. Chúng tôi mang đến những chiếc xe mới nhất, bảo dưỡng định kỳ để đảm bảo an toàn tuyệt đối cho chuyến đi của bạn.",
        feat_1: "Xe đời mới, vận hành êm ái.",
        feat_2: "Giao xe tận nơi khách sạn/resort.",
        feat_3: "Hỗ trợ nón bảo hiểm, áo mưa.",
        feat_4: "Thủ tục đơn giản, nhanh chóng.",
        services_title: "Đội Xe Của Chúng Tôi",
        services_desc: "Đa dạng các dòng xe tay ga từ bình dân đến cao cấp",
        bike_1_name: "Honda AirBlade 2012 - Phiên bản đỏ đen",
        bike_2_name: "Honda AirBlade 2012 - Phiên bản trắng đen",
        bike_3_name: "Yamaha Nouvo 6 - Phiên bản trắng",
        bike_4_name: "Honda Vision 2014 - Phiên bản đỏ",

        price_day: "/ ngày",
        spec_gas: "Tiết kiệm xăng",
        spec_trunk: "Cốp rộng",
        spec_engine: "Động cơ mạnh",
        spec_comfort: "Thoải mái 2 người",
        spec_sport: "Thể thao",
        spec_grip: "Bám đường tốt",
        btn_book: "Đặt Xe",
        explore_title: "Khám Phá Phan Thiết - Mũi Né",
        explore_desc: "Những điểm đến không thể bỏ lỡ cùng chiếc xe của bạn",
        dest_1_name: "Đồi Cát Bay",
        dest_1_desc: "Trải nghiệm trượt cát đầy thú vị.",
        dest_2_name: "Biển Hòn Rơm",
        dest_2_desc: "Bãi biển xanh thơ mộng.",
        dest_3_name: "Bàu Trắng",
        dest_3_desc: "Cung đường ven biển đẹp nhất Việt Nam.",
        dest_4_name: "Bãi Đá Ông Địa",
        dest_4_desc: "Check-in sống ảo cực chất.",
        dest_addr_1: "01 Hòn Rơm, ĐT716, Mũi Né, Phan Thiết",
        dest_addr_2: "Xuân Thủy, Mũi Né, Phan Thiết",
        dest_addr_3: "Hòa Thắng - Hòa Phú, Bắc Bình, Bình Thuận",
        dest_addr_4: "Nguyễn Đình Chiểu, Hàm Tiến, Phan Thiết",
        btn_map: "Xem Bản Đồ",
        map_title: "Địa Chỉ Của Chúng Tôi",
        footer_desc: "Đồng hành cùng bạn trên mọi nẻo đường Phan Thiết - Mũi Né. Dịch vụ uy tín, tận tâm, chất lượng.",
        footer_contact: "Liên Hệ",
        footer_follow: "Theo Dõi",
        footer_copyright: "&copy; 2026 Xe Máy Ngọc Mười. All rights reserved.",
        hero_btn: "Đặt Xe Ngay",
        contact_title: "Liên Hệ Với Chúng Tôi",
        btn_call: "Gọi Điện Thoại",
        btn_whatsapp: "Chat WhatsApp"
    },
    en: {
        nav_home: "Home",
        nav_about: "About Us",
        nav_services: "Our Fleet",
        nav_explore: "Explore",
        nav_contact: "Contact",
        nav_language: "Language",
        hero_subtitle: "Welcome to <br class='mobile-break'> Phan Thiet - Muine",
        hero_title: "Freedom Journey With <br> <span class='text-gold'>Ngoc Muoi Motorbikes</span>",
        hero_desc: "Premium and reliable scooter rental service. Discover the most beautiful coastal roads in Vietnam your own way.",
        hero_btn_call: "<i class='fas fa-phone-alt'></i> Call Now",
        hero_btn_view: "View Bikes",
        about_title: "Why Choose Us?",
        about_desc: "Ngoc Muoi Motorbikes is proud to be the leading motorbike rental service in Phan Thiet - Mui Ne. We provide the newest bikes, regularly maintained to ensure absolute safety for your trip.",
        feat_1: "New model bikes, smooth operation.",
        feat_2: "Delivery to hotel/resort.",
        feat_3: "Helmets and raincoats included.",
        feat_4: "Simple and fast procedure.",
        services_title: "Our Fleet",
        services_desc: "A variety of scooters from budget to premium",
        bike_1_name: "Honda AirBlade 2012 - Red & Black Edition",
        bike_2_name: "Honda AirBlade 2012 - White & Black Edition",
        bike_3_name: "Yamaha Nouvo 6 - White Edition",
        bike_4_name: "Honda Vision 2014 - Red Edition",
        price_day: "/ day",
        spec_gas: "Fuel efficient",
        spec_trunk: "Large trunk",
        spec_engine: "Powerful engine",
        spec_comfort: "Comfortable for 2",
        spec_sport: "Sporty design",
        spec_grip: "Good grip",
        btn_book: "Book Now",
        explore_title: "Explore Phan Thiet - Mui Ne",
        explore_desc: "Unmissable destinations with your bike",
        dest_1_name: "Red Sand Dunes",
        dest_1_desc: "Exciting sand sliding experience.",
        dest_2_name: "Hon Rom Beach",
        dest_2_desc: "Blue sea and poetic coconut groves.",
        dest_3_name: "Bau Trang (White Sand Dunes)",
        dest_3_desc: "The most beautiful coastal road in Vietnam.",
        dest_4_name: "Ong Dia Rock Beach",
        dest_4_desc: "Great spot for photos.",
        dest_addr_1: "01 Hon Rom, DT716, Mui Ne, Phan Thiet",
        dest_addr_2: "Xuan Thuy, Mui Ne, Phan Thiet",
        dest_addr_3: "Hoa Thang - Hoa Phu, Bac Binh, Binh Thuan",
        dest_addr_4: "Nguyen Dinh Chieu, Ham Tien, Phan Thiet",
        btn_map: "View On Map",
        map_title: "Our Address",
        footer_desc: "Accompanying you on every road in Phan Thiet - Mui Ne. Reliable, dedicated, quality service.",
        footer_contact: "Contact",
        footer_follow: "Follow Us",
        footer_copyright: "&copy; 2026 Ngoc Muoi Motorbikes. All rights reserved.",
        hero_btn: "Book Now",
        contact_title: "Contact Us",
        btn_call: "Call Us",
        btn_whatsapp: "Chat on WhatsApp"
    },
    ru: {
        nav_home: "Главная",
        nav_about: "О нас",
        nav_services: "Мотоциклы",
        nav_explore: "Изучить",
        nav_contact: "Контакты",
        nav_language: "Язык",
        hero_subtitle: "Добро пожаловать в <br class='mobile-break'> Фантьет - Муине",
        hero_title: "Путешествие Свободы с <br> <span class='text-gold'>Ngoc Muoi Motorbikes</span>",
        hero_desc: "Премиальный и надежный прокат скутеров. Откройте для себя самые красивые прибрежные дороги Вьетнама по-своему.",
        hero_btn_call: "<i class='fas fa-phone-alt'></i> Позвонить",
        hero_btn_view: "Смотреть байки",
        about_title: "Почему выбирают нас?",
        about_desc: "Ngoc Muoi Motorbikes гордится тем, что является ведущим сервисом по прокату мотоциклов в Фантьете - Муйне. Мы предоставляем новейшие байки с регулярным техобслуживанием для вашей безопасности.",
        feat_1: "Новые модели, плавная езда.",
        feat_2: "Доставка в отель/курорт.",
        feat_3: "Шлемы и дождевики включены.",
        feat_4: "Простая и быстрая процедура.",
        services_title: "Наш Автопарк",
        services_desc: "Разнообразие скутеров от эконом до премиум класса",
        bike_1_name: "Honda AirBlade 2012 - Красно-черная версия",
        bike_2_name: "Honda AirBlade 2012 - Бело-черная версия",
        bike_3_name: "Yamaha Nouvo 6 - Белая версия",
        bike_4_name: "Honda Vision 2014 - Красная версия",
        price_day: "/ день",
        spec_gas: "Экономичный",
        spec_trunk: "Большой багажник",
        spec_engine: "Мощный двигатель",
        spec_comfort: "Удобно для двоих",
        spec_sport: "Спортивный дизайн",
        spec_grip: "Хорошее сцепление",
        btn_book: "Забронировать",
        explore_title: "Исследуйте Фантьет - Муйне",
        explore_desc: "Места, которые нельзя пропустить",
        dest_1_name: "Красные дюны",
        dest_1_desc: "Захватывающий опыт катания на песке.",
        dest_2_name: "Пляж Хон Ром",
        dest_2_desc: "Голубое море и поэтичные кокосовые рощи.",
        dest_3_name: "Белые дюны (Bau Trang)",
        dest_3_desc: "Самая красивая прибрежная дорога во Вьетнаме.",
        dest_4_name: "Пляж Онг Диа (Ong Dia Rock)",
        dest_4_desc: "Отличное место для фото.",
        dest_addr_1: "01 Хон Ром, DT716, Муйне, Фантьет",
        dest_addr_2: "Сюань Туй, Муйне, Фантьет",
        dest_addr_3: "Хоа Тханг - Хоа Фу, Бак Бинь, Бинь Туан",
        dest_addr_3: "Хоа Тханг - Хоа Фу, Бак Бинь, Бинь Туан",
        dest_addr_4: "Нгуен Динь Чиеу, Хам Тьен, Фантьет",
        btn_map: "Посмотреть на карте",
        map_title: "Наш адрес",
        footer_desc: "Сопровождаем вас на каждой дороге в Фантьете - Муйне. Надежный, качественный сервис.",
        footer_contact: "Контакты",
        footer_follow: "Подписаться",
        footer_copyright: "&copy; 2026 Ngoc Muoi Motorbikes. Все права защищены.",
        hero_btn: "Забронировать сейчас",
        contact_title: "Свяжитесь с нами",
        btn_call: "Позвонить",
        btn_whatsapp: "Чат в WhatsApp"
    },
    zh: {
        nav_home: "首页",
        nav_about: "关于我们",
        nav_services: "车队",
        nav_explore: "探索",
        nav_contact: "联系我们",
        nav_language: "语言",
        hero_subtitle: "欢迎来到 <br class='mobile-break'> 潘切 - 美奈",
        hero_title: "与 <br> <span class='text-gold'>Ngoc Muoi 机车</span> 一起自由之旅",
        hero_desc: "优质可靠的踏板车租赁服务。以您自己的方式探索越南最美的沿海公路。",
        hero_btn_call: "<i class='fas fa-phone-alt'></i> 立即致电",
        hero_btn_view: "查看车辆",
        about_title: "为什么选择我们？",
        about_desc: "Ngoc Muoi Motorbikes 自豪地成为潘切-美奈领先的摩托车租赁服务。我们提供定期维护的最新车辆，确保您旅途的绝对安全。",
        feat_1: "新款车型，行驶平稳。",
        feat_2: "送车至酒店/度假村。",
        feat_3: "包含头盔和雨衣。",
        feat_4: "手续简单快捷。",
        services_title: "我们的车队",
        services_desc: "从经济型到豪华型的各种踏板车",
        bike_1_name: "本田 AirBlade 2012 - 红黑版",
        bike_2_name: "本田 AirBlade 2012 - 白黑版",
        bike_3_name: "雅马哈 Nouvo 6 - 白色版",
        bike_4_name: "本田 Vision 2014 - 红色版",
        price_day: "/ 天",
        spec_gas: "省油",
        spec_trunk: "大后备箱",
        spec_engine: "强劲引擎",
        spec_comfort: "双人舒适",
        spec_sport: "运动设计",
        spec_grip: "抓地力好",
        btn_book: "立即预订",
        explore_title: "探索潘切 - 美奈",
        explore_desc: "骑行不可错过的目的地",
        dest_1_name: "红沙丘",
        dest_1_desc: "刺激的滑沙体验。",
        dest_2_name: "Hon Rom 海滩",
        dest_2_desc: "碧海和诗意的椰林。",
        dest_3_name: "白沙丘 (Bau Trang)",
        dest_3_desc: "越南最美的沿海公路。",
        dest_4_name: "翁地亚岩石海滩 (Ong Dia Rock)",
        dest_4_desc: "很棒的拍照地点。",
        dest_addr_1: "01 Hon Rom, DT716, Mui Ne, Phan Thiet",
        dest_addr_2: "Xuan Thuy, Mui Ne, Phan Thiet",
        dest_addr_3: "Hoa Thang - Hoa Phu, Bac Binh, Binh Thuan",
        dest_addr_3: "Hoa Thang - Hoa Phu, Bac Binh, Binh Thuan",
        dest_addr_4: "Nguyen Dinh Chieu, Ham Tien, Phan Thiet",
        btn_map: "查看地图",
        map_title: "我们的地址",
        footer_desc: "在潘切-美奈的每一条道路上陪伴您。可靠、敬业、优质的服务。",
        footer_contact: "联系方式",
        footer_follow: "关注我们",
        footer_copyright: "&copy; 2026 Ngoc Muoi Motorbikes. 保留所有权利。",
        hero_btn: "立即预订",
        contact_title: "联系我们",
        btn_call: "致电",
        btn_whatsapp: "WhatsApp 聊天"
    }
};

function switchLanguage(lang) {
    localStorage.setItem('preferredLayout', lang);
    const elements = document.querySelectorAll('[data-i18n]');

    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            if (key === 'hero_title' || key === 'hero_subtitle' || key.includes('btn') || key === 'footer_copyright') {
                el.innerHTML = translations[lang][key];
            } else {
                el.textContent = translations[lang][key];
            }
        }
    });

    // Update Dropdown Label
    const currentLangDisplay = document.getElementById('current-lang-display');
    const flagMap = {
        'vi': 'vietnam.webp',
        'en': 'usa.webp',
        'ru': 'russia.webp',
        'zh': 'china.webp'
    };
    if (currentLangDisplay && flagMap[lang]) {
        currentLangDisplay.innerHTML = `<img src="assets/images/languages/${flagMap[lang]}" class="lang-flag" alt="${lang.toUpperCase()}">`;
    }

    // Highlight active language in mobile dropdown
    document.querySelectorAll('.mobile-lang-dropdown a').forEach(btn => {
        btn.style.fontWeight = '500';
        btn.style.color = 'var(--text-dark)';
        if (btn.getAttribute('onclick').includes(`'${lang}'`)) {
            btn.style.fontWeight = '700';
            btn.style.color = 'var(--primary-color)';
        }
    });
}

function toggleMobileLangMenu() {
    const menu = document.getElementById('mobile-lang-dropdown');
    const arrow = document.getElementById('mobile-lang-arrow');
    if (menu) {
        if (menu.style.display === 'none' || menu.style.display === '') {
            menu.style.display = 'block';
            if (arrow) arrow.style.transform = 'rotate(180deg)';
        } else {
            menu.style.display = 'none';
            if (arrow) arrow.style.transform = 'rotate(0deg)';
        }
    }
}

// Mobile Menu Toggle
const mobileMenuBtn = document.getElementById('mobile-menu-btn');
const closeMenuBtn = document.getElementById('close-menu-btn');
const mobileNav = document.getElementById('mobile-nav');

function openMenu() {
    mobileNav.classList.add('active');
}

function closeMenu() {
    mobileNav.classList.remove('active');
}

if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener('click', openMenu);
}

if (closeMenuBtn) {
    closeMenuBtn.addEventListener('click', closeMenu);
}

// Close menu when clicking outside
window.addEventListener('click', (e) => {
    if (e.target === mobileNav) {
        closeMenu();
    }
});

// Header Scroll Effect
const header = document.querySelector('header');

window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
});

// Initialize Language
window.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferredLayout') || 'vi';
    switchLanguage(savedLang);
});

/* Product Modal Logic */
const bikeData = {
    1: {
        img: 'assets/images/products/ab1.webp', // Placeholder 
        name_key: 'bike_1_name',
        price: '150.000đ',
        specs: [
            { icon: 'fas fa-gas-pump', text_key: 'spec_gas' },
            { icon: 'fas fa-suitcase', text_key: 'spec_trunk' },
            { icon: 'fas fa-motorcycle', text_key: 'feat_1' }
        ]
    },
    2: {
        img: 'assets/images/products/ab2.webp',
        name_key: 'bike_2_name',
        price: '150.000đ',
        specs: [
            { icon: 'fas fa-tachometer-alt', text_key: 'spec_engine' },
            { icon: 'fas fa-user-friends', text_key: 'spec_comfort' },
            { icon: 'fas fa-shield-alt', text_key: 'feat_3' }
        ]
    },
    3: {
        img: 'assets/images/products/nouvo-6.webp',
        name_key: 'bike_3_name',
        price: '150.000đ',
        specs: [
            { icon: 'fas fa-bolt', text_key: 'spec_sport' },
            { icon: 'fas fa-road', text_key: 'spec_grip' },
            { icon: 'fas fa-motorcycle', text_key: 'feat_1' }
        ]
    },
    4: {
        img: 'assets/images/products/vision-do.webp',
        name_key: 'bike_4_name',
        price: '150.000đ',
        specs: [
            { icon: 'fas fa-leaf', text_key: 'spec_gas' },
            { icon: 'fas fa-female', text_key: 'spec_comfort' },
            { icon: 'fas fa-shopping-bag', text_key: 'spec_trunk' }
        ]
    }
};

function openProductModal(id) {
    const data = bikeData[id];
    if (!data) return;

    const lang = localStorage.getItem('preferredLayout') || 'vi';
    const t = translations[lang];

    const imgEl = document.getElementById('modal-img');
    if (imgEl) imgEl.src = data.img;

    const titleEl = document.getElementById('modal-title');
    if (titleEl) {
        titleEl.textContent = t[data.name_key] || data.name_key;
        titleEl.setAttribute('data-i18n', data.name_key);
    }

    const priceEl = document.getElementById('modal-price');
    if (priceEl && t['price_day']) {
        priceEl.innerHTML = `${data.price} <span data-i18n="price_day">${t['price_day']}</span>`;
    }

    const specsContainer = document.getElementById('modal-specs');
    if (specsContainer) {
        specsContainer.innerHTML = '';
        data.specs.forEach(spec => {
            const div = document.createElement('div');
            div.innerHTML = `<i class="${spec.icon}"></i> <span data-i18n="${spec.text_key}">${t[spec.text_key] || spec.text_key}</span>`;
            specsContainer.appendChild(div);
        });
    }

    const modal = document.getElementById('product-modal');
    if (modal) modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeProductModal() {
    const modal = document.getElementById('product-modal');
    if (modal) modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

const productModal = document.getElementById('product-modal');
if (productModal) {
    productModal.addEventListener('click', function (e) {
    });
}

/* Back to Top Button Logic */
const backToTopBtn = document.getElementById('back-to-top');

if (backToTopBtn) {
    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            backToTopBtn.classList.add('show');
        } else {
            backToTopBtn.classList.remove('show');
        }
    });

    backToTopBtn.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
}

/* Contact Modal Logic */
function openContactModal() {
    const modal = document.getElementById('contact-modal');
    if (modal) modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeContactModal() {
    const modal = document.getElementById('contact-modal');
    if (modal) modal.classList.remove('active');
    document.body.style.overflow = '';
}

// Close modal when clicking outside
const contactModal = document.getElementById('contact-modal');
if (contactModal) {
    contactModal.addEventListener('click', function (e) {
        if (e.target === this) closeContactModal();
    });
}

/* Explore Modal Logic */
const destData = {
    1: {
        img: 'assets/images/locations/doi-cat-bay.webp',
        name_key: 'dest_1_name',
        desc_key: 'dest_1_desc',
        addr_key: 'dest_addr_1',
        map_link: 'https://maps.google.com/?q=Red+Sand+Dunes+Mui+Ne'
    },
    2: {
        img: 'assets/images/locations/bien-hon-rom.webp',
        name_key: 'dest_2_name',
        desc_key: 'dest_2_desc',
        addr_key: 'dest_addr_2',
        map_link: 'https://maps.google.com/?q=Hon+Rom+Beach+Phan+Thiet'
    },
    3: {
        img: 'assets/images/locations/bau-trang.webp',
        name_key: 'dest_3_name',
        desc_key: 'dest_3_desc',
        addr_key: 'dest_addr_3',
        map_link: 'https://maps.google.com/?q=Bau+Trang+White+Sand+Dunes'
    },
    4: {
        img: 'assets/images/locations/da-ong-dia.webp',
        name_key: 'dest_4_name',
        desc_key: 'dest_4_desc',
        addr_key: 'dest_addr_4',
        map_link: 'https://maps.google.com/?q=Bai+Da+Ong+Dia+Phan+Thiet'
    }
};

function openExploreModal(id) {
    const data = destData[id];
    if (!data) return;

    const lang = localStorage.getItem('preferredLayout') || 'vi';
    const t = translations[lang];

    const imgEl = document.getElementById('explore-img');
    if (imgEl) imgEl.src = data.img;

    const titleEl = document.getElementById('explore-title');
    if (titleEl) {
        titleEl.textContent = t[data.name_key] || data.name_key;
        titleEl.setAttribute('data-i18n', data.name_key);
    }

    const descEl = document.getElementById('explore-desc');
    if (descEl) {
        descEl.textContent = t[data.desc_key] || data.desc_key;
        descEl.setAttribute('data-i18n', data.desc_key);
    }

    const addrEl = document.getElementById('explore-addr');
    if (addrEl && data.addr_key) {
        addrEl.innerHTML = `<i class="fas fa-map-marker-alt"></i> <span data-i18n="${data.addr_key}">${t[data.addr_key]}</span>`;
    }

    const mapBtn = document.getElementById('explore-map-btn');
    if (mapBtn) {
        mapBtn.href = data.map_link;
        const span = mapBtn.querySelector('span');
        if (span) span.textContent = t['btn_map'];
    }

    const modal = document.getElementById('explore-modal');
    if (modal) modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeExploreModal() {
    const modal = document.getElementById('explore-modal');
    if (modal) modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

const exploreModal = document.getElementById('explore-modal');
if (exploreModal) {
    exploreModal.addEventListener('click', function (e) {
        if (e.target === this) closeExploreModal();
    });
}

/* Product Carousel Logic */

/* Generic Carousel Logic */
function setupSlider(trackId, prevBtnId, nextBtnId) {
    const track = document.getElementById(trackId);
    const prevBtn = document.getElementById(prevBtnId);
    const nextBtn = document.getElementById(nextBtnId);

    if (!track || !prevBtn || !nextBtn) return;

    let currentIndex = 0;
    const gap = 30; // Matches CSS gap

    function getItemsVisible() {
        if (window.innerWidth <= 600) return 1;
        if (window.innerWidth <= 991) return 2;
        return 3;
    }

    function updateSlider() {
        const items = track.children;
        const totalItems = items.length;
        const itemsVisible = getItemsVisible();
        // Allow index to go up to totalItems for wrap-around calculation, but clamp for display

        // Ensure index bounds for standard display
        // With infinite loop, index logic changes slightly, but for simple slide:
        // We will just loop currentIndex logic in button handlers.

        // Recalculate maxIndex just to be safe for current layout
        const maxIndex = Math.max(0, totalItems - itemsVisible);

        // Force bounds if resized
        if (currentIndex > maxIndex) currentIndex = maxIndex;
        if (currentIndex < 0) currentIndex = 0;

        // Get card width dynamically
        if (items.length > 0) {
            const cardWidth = items[0].getBoundingClientRect().width;
            const moveAmount = (cardWidth + gap) * currentIndex;
            track.style.transform = `translateX(-${moveAmount}px)`;
        }

        // Update Button States - Always active for infinite loop
        prevBtn.classList.remove('disabled');
        nextBtn.classList.remove('disabled');
    }

    nextBtn.addEventListener('click', () => {
        const itemsVisible = getItemsVisible();
        const maxIndex = Math.max(0, track.children.length - itemsVisible); // Ensure maxIndex >= 0

        if (currentIndex < maxIndex) {
            currentIndex++;
        } else {
            // Loop back to start
            currentIndex = 0;
        }
        updateSlider();
    });

    prevBtn.addEventListener('click', () => {
        const itemsVisible = getItemsVisible();
        const maxIndex = Math.max(0, track.children.length - itemsVisible);

        if (currentIndex > 0) {
            currentIndex--;
        } else {
            // Loop to end
            currentIndex = maxIndex;
        }
        updateSlider();
    });

    // Touch Events for Mobile Swipe
    let touchStartX = 0;
    let touchEndX = 0;
    const minSwipeDistance = 50;

    track.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    track.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }, { passive: true });

    function handleSwipe() {
        const diff = touchStartX - touchEndX;
        if (Math.abs(diff) > minSwipeDistance) {
            if (diff > 0) {
                // Swipe Left -> Next
                nextBtn.click();
            } else {
                // Swipe Right -> Prev
                prevBtn.click();
            }
        }
    }

    // Check bounds on resize
    window.addEventListener('resize', () => {
        const itemsVisible = getItemsVisible();
        const maxIndex = Math.max(0, track.children.length - itemsVisible);
        if (currentIndex > maxIndex) currentIndex = maxIndex;
        updateSlider();
    });

    // Initial check
    setTimeout(updateSlider, 100);
}

document.addEventListener('DOMContentLoaded', () => {
    // Init Fleet Slider
    setupSlider('slider-track', 'slider-prev', 'slider-next');

    // Init Explore Slider
    setupSlider('explore-track', 'explore-prev', 'explore-next');
});
